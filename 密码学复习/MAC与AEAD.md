# MAC与AEAD
## 完整性及其对安全性的影响
· 完整性是指消息的接收者应该能够验证在传送的过程中消息没有被修改；攻击者不可能用假消息代替合法消息

· 对安全性的影响：缺少完整性保护的系统会受到 内容修改 、 顺序修改 和 计时修改 的攻击

· 内容修改：对消息内容进行修改，包括插入、删除、转换和修改

· 顺序修改： 对通信双方的消息顺序进行修改，包括插入、删除、重新排序

· 计时修改： 对消息的重播和延时

## MAC（消息认证码）
### MAC的定义
· MAC利用密钥来生成固定长度的短数据块，并将该数据块附加在消息之后
```
MAC = C（K，M）
//其中M为明文消息，C为MAC函数，K为共享密钥
```

· 将消息和MAC一起发送给消息接收方。接收方对消息使用相同的密钥K进行相同的运算得出MAC，并且将计算出的MAC与消息附加的MAC进行比较。

· 一般来说，MAC函数与加密类似，但是MAC算法要求不可逆，而加密算法必须是可逆的

### 常用的MAC算法
#### HMAC
· HAMAC是基于hash算法的消息认证码

· HMAC的算法描述如下
```
HMAC(K,M) = H[(K'⊕ opad) || H[(K'⊕ipad)||M]]
//在K左侧填充0使其达到分组长度，记为K’
```

· HMAC流程如下
```
1. 在K左边填充0，得到b位的K’
2. K'与ipad执行异或运算得到长度为b位的分组Si
3. 将M附于Si之后
4. 将H作用于第3步的结果上
5. 将K'于opad执行异或操作产生长度为b位的分组S0
6. 将第4步得到的Hash码依附于S0之后
7. 将H作用域第6步的结果，输出最终的结果为所需要的MAC值
```

### CBC-MAC
· 基于分组密码AES实现的MAC

· 加密步骤
```
1. 首先将数据按照l比特分组，最后不足分组长度的使用固定的pad补足，得到分组D1D2...Dn
2. 将D1与初始向量IV异或之后进行加密得到第一组密文C1
3. 将D2与上一步骤的结果C1异或之后及逆行加密得到C2
4. 之后的数据以此类推，得到Cn，最终的Cn就是该消息认证码
```

· CBC-MAC的安全性
```
每一个密钥都只能被用于固定长度和已知长度的消息
如果使用的分组密码算法是安全的，则CBC-MAC对于固定长度的消息是安全的
CBC-MAC对于可变长度的消息是不安全的
```




## AEAD
### AEAD的定义
· AEAD是一种同时提供保密性以及完整性（认证）的加密系统。

### AEAD的常用模式
· 对于消息M有四种同时提供保密性以及完整性的通用方案
```
1. 先Hash再加密。对于明文M使用Hash函数计算H(M),再将M与H(M)一起加密：E(K,(M,H(M)))

2. 先认证再加密。使用两个密钥K1，K2。先计算明文M的MAC值T=MAC(K1,M),再将MAC值与明文一起加密：E(K2,(M,T))

3. 先加密再认证。使用两个密钥K1，K2。先对明文M加密得到密文C=E(K2,M),再计算密文C的MAC值T=MAC(K1,C)

4. 独立进行加密和认证。

```

